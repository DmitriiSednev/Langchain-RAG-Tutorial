# RAG Tutorial с поддержкой различных форматов документов

Этот проект представляет собой систему RAG (Retrieval-Augmented Generation), которая позволяет задавать вопросы по содержимому различных документов (PDF, TXT, MD, DOCX и др.).

## Особенности

- Поддержка различных форматов документов (PDF, TXT, MD, DOCX и др.)
- Гибкая настройка эмбеддингов (OpenAI, Ollama, AWS Bedrock)
- Поддержка различных LLM (OpenAI GPT, Ollama - локальная LLM)
- Интерактивный режим запросов
- Тесты для проверки функциональности
- Сравнение качества разных типов эмбеддингов
- Автоматическое обновление базы данных при добавлении новых документов

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/rag-tutorial.git
cd rag-tutorial
```

2. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv .venv
# Для Windows:
.venv\Scripts\activate
# Для Linux/Mac:
source .venv/bin/activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env` в корневой директории проекта и добавьте необходимые переменные окружения:
```env
OPENAI_API_KEY=your_api_key_here
EMBEDDING_TYPE=openai  # или ollama, или bedrock
LLM_TYPE=openai  # или ollama
```

### Установка локальной LLM (Ollama)

Если вы хотите использовать локальную LLM через Ollama:

1. Установите Ollama с официального сайта: https://ollama.ai/
2. Запустите Ollama
3. Скачайте модель llama2:
```bash
ollama pull llama2
```
4. В файле `.env` установите:
```env
LLM_TYPE=ollama
```

## Тестовые документы

В папке `data/` уже есть тестовые документы для проверки системы:
- `ticket_to_ride.pdf` - правила игры "Ticket to Ride"
- `monopoly.pdf` - правила игры "Монополия"
- `alice_in_wonderland.md` - отрывок из книги "Алиса в стране чудес"

Эти документы используются в тестах и примерах запросов. Вы можете:
1. Использовать их для тестирования системы
2. Заменить их на свои документы
3. Добавить дополнительные документы

## Использование

1. Поместите ваши документы в папку `data/`. Поддерживаются следующие форматы:
   - PDF файлы
   - Текстовые файлы (.txt)
   - Markdown файлы (.md)
   - Word документы (.docx)
   - и другие форматы, поддерживаемые LangChain

2. Создайте базу данных из ваших документов:
```bash
python create_database.py
```

3. При добавлении новых документов обновите базу данных:
```bash
python update_database.py
```

4. Запустите интерактивный режим для запросов:
```bash
python query_database.py
```

5. Задавайте вопросы о содержимом документов. Например:
```
Ваш вопрос: сколько очков дается за самый длинный поезд в игре ticket_to_ride
```

## Сравнение эмбеддингов

Для сравнения качества и производительности разных типов эмбеддингов используйте:
```bash
python compare_embeddings.py
```

Этот скрипт:
- Тестирует разные типы эмбеддингов (OpenAI, Ollama) на одних и тех же вопросах
- Измеряет время ответа для каждого типа
- Сохраняет результаты в файл `embedding_comparison.json`

## Возможные проблемы и их решения

1. Ошибка с OpenAI API:
   - Проверьте, что у вас установлен правильный API ключ в файле `.env`
   - Убедитесь, что у вас есть доступ к API OpenAI

2. Ошибка с Chroma:
   - Убедитесь, что все зависимости установлены корректно
   - Попробуйте переустановить Chroma: `pip install --upgrade chromadb`

3. Ошибка с документами:
   - Проверьте, что документы находятся в папке `data/`
   - Убедитесь, что документы имеют поддерживаемый формат
   - Проверьте права доступа к файлам

4. Ошибка с Ollama:
   - Убедитесь, что Ollama установлена и запущена
   - Проверьте, что модель llama2 скачана
   - Проверьте, что в .env установлен LLM_TYPE=ollama

## Тестирование

Для запуска тестов используйте:
```bash
pytest test_rag.py -v
```

## Структура проекта

- `create_database.py` - создание базы данных из документов
- `update_database.py` - обновление базы данных при добавлении новых документов
- `query_database.py` - интерактивный режим для запросов
- `get_embedding_function.py` - настройка функций эмбеддингов
- `compare_embeddings.py` - сравнение качества разных типов эмбеддингов
- `test_rag.py` - тесты системы
- `data/` - папка для документов
- `chroma/` - папка с базой данных (создается автоматически)

## Лицензия

MIT